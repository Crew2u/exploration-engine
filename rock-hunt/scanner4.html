<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Prospecting Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin:0;
  background:#050b10;
  color:#0ff;
  font-family:Arial, sans-serif;
  overflow:hidden;
}

#ui {
  position:absolute;
  inset:0;
  pointer-events:none;
}

button {
  pointer-events:auto;
}

#controls {
  position:absolute;
  bottom:10px;
  width:100%;
  text-align:center;
}

#radar {
  position:absolute;
  top:50%;
  left:50%;
  width:260px;
  height:260px;
  margin:-130px;
  border-radius:50%;
  border:2px solid rgba(0,255,255,.6);
  overflow:hidden;
  background:radial-gradient(circle at center, rgba(0,255,255,.08), #000 70%);
  z-index:1;
}

.ring {
  position:absolute;
  inset:10%;
  border-radius:50%;
  border:1px solid rgba(0,255,255,.15);
}

#sweep {
  position:absolute;
  width:50%;
  height:2px;
  background:linear-gradient(to right, rgba(0,255,255,.8), transparent);
  top:50%;
  left:50%;
  transform-origin:left center;
  animation:sweep 3s linear infinite;
}

@keyframes sweep {
  from { transform:rotate(0deg); }
  to { transform:rotate(360deg); }
}

.rock {
  position:absolute;
  width:6px;
  height:6px;
  border-radius:50%;
  background:#0ff;
  opacity:.6;
  z-index:0;
}

#data {
  position:absolute;
  top:10px;
  width:100%;
  text-align:center;
  z-index:2;
}

#qrPanel {
  position:absolute;
  inset:10%;
  background:#000;
  border:2px solid #0ff;
  display:none;
  z-index:5;
}

iframe {
  width:100%;
  height:100%;
  border:none;
  filter:contrast(1.2) brightness(1.1);
}
</style>
</head>

<body>

<div id="ui">
  <div id="data">
    <div id="distance">Distance: -- m</div>
    <div id="bearing">Bearing: --°</div>
  </div>

  <div id="radar">
    <div class="ring"></div>
    <div class="ring" style="inset:30%"></div>
    <div id="sweep"></div>
  </div>

  <div id="qrPanel">
    <iframe id="qrFrame"></iframe>
  </div>

  <div id="controls">
    <button id="toggle">Activate Scanner</button>
    <button id="navBtn" style="display:none;">Navigate</button>
  </div>
</div>

<script>
/* ---------------- CONFIG ---------------- */
let scannerActive=false;
let currentPos=null;
let target=null;
let rocks=[];
let vibrated=false;

/* Example fallback locations */
const locations=[
  {name:"Rock Alpha",lat:-26.63,lng:152.95,url:"https://example.com/rock1"}
];

/* ---------------- INIT ---------------- */
const radar=document.getElementById("radar");
const toggleBtn=document.getElementById("toggle");
const navBtn=document.getElementById("navBtn");
const distanceEl=document.getElementById("distance");
const bearingEl=document.getElementById("bearing");

toggleBtn.onclick=()=>{
  scannerActive=!scannerActive;
  toggleBtn.textContent=scannerActive?"Deactivate Scanner":"Activate Scanner";
};

/* ---------------- GPS ---------------- */
navigator.geolocation.watchPosition(pos=>{
  currentPos=pos.coords;
},err=>console.warn(err),{enableHighAccuracy:true});

/* ---------------- RADAR UPDATE ---------------- */
function update(){
  if(!scannerActive||!currentPos||!target)return;

  const d=distance(currentPos,target);
  distanceEl.textContent=`Distance: ${Math.round(d)} m`;

  if(d>100){
    navBtn.style.display="inline-block";
    radar.style.display="none";
  } else {
    navBtn.style.display="none";
    radar.style.display="block";
  }

  if(d<15 && !vibrated){
    navigator.vibrate(100);
    vibrated=true;
  }
  if(d>20) vibrated=false;

  updateRocks(d);
}

setInterval(update,100);

/* ---------------- ROCKS ---------------- */
function updateRocks(dist){
  rocks.forEach(r=>r.remove());
  rocks=[];

  const pct=Math.min(dist/100,1);
  const r=120*pct;

  const dot=document.createElement("div");
  dot.className="rock";
  dot.style.left=130+r*Math.cos(Date.now()/800)+"px";
  dot.style.top=130+r*Math.sin(Date.now()/800)+"px";
  radar.appendChild(dot);
  rocks.push(dot);
}

/* ---------------- NAV ---------------- */
navBtn.onclick=()=>{
  if(!target)return;
  const url=`https://www.google.com/maps/dir/?api=1&destination=${target.lat},${target.lng}`;
  window.open(url,"_blank");
};

/* ---------------- UTIL ---------------- */
function distance(a,b){
  const R=6371e3;
  const φ1=a.latitude*Math.PI/180;
  const φ2=b.lat*Math.PI/180;
  const dφ=(b.lat-a.latitude)*Math.PI/180;
  const dλ=(b.lng-a.longitude)*Math.PI/180;
  const x=Math.sin(dφ/2)**2+
    Math.cos(φ1)*Math.cos(φ2)*Math.sin(dλ/2)**2;
  return R*2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));
}

/* ---------------- SELECT FIRST TARGET ---------------- */
target=locations[0];
</script>

</body>
</html>
