<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Futuristic Prospecting Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
body {
  margin:0;
  font-family:system-ui,sans-serif;
  background:#000;
  color:#0f0;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:10px;
}
h1 {
  margin:10px 0;
  text-align:center;
  text-shadow:0 0 10px #0f0,0 0 20px #0f0555;
}

#deviceFrame {
  width:400px;
  height:400px;
  border:10px solid #00ff44;
  border-radius:30px;
  box-shadow:0 0 50px #00ff44 inset;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  background:#001100;
}

#scanner-container {
  width:360px;
  height:360px;
  border-radius:50%;
  position:relative;
  overflow:hidden;
  background:radial-gradient(circle,#001100 0%,#002200 80%);
  box-shadow: inset 0 0 30px #00ff0044,0 0 40px #00ff0088;
  border:3px solid #00ff00;
}

#overlayPulse {
  position:absolute;
  inset:0;
  border-radius:50%;
  box-shadow:0 0 40px #00ff44 inset,0 0 60px #00ff4488 inset;
  animation:pulse 2s infinite alternate;
  z-index:1;
}

@keyframes pulse {
  from { transform:scale(0.97); opacity:0.7; }
  to { transform:scale(1); opacity:1; }
}

#radarSweep {
  position:absolute;
  inset:0;
  border-radius:50%;
  background:conic-gradient(rgba(0,255,0,0.25),rgba(0,255,0,0) 30deg);
  filter:blur(1px);
  z-index:2;
}

#radarArc {
  position:absolute;
  inset:0;
  border-radius:50%;
  box-shadow:0 0 20px #00ff44 inset,0 0 30px #00ff4488 inset;
  z-index:3;
}

#arrow {
  position:absolute;
  bottom:50%;
  left:50%;
  width:4px;
  height:120px;
  background:#ff4444;
  transform-origin:bottom center;
  transform:translateX(-50%);
  border-radius:4px;
  box-shadow:0 0 8px #ff4444,0 0 20px #ff4444aa;
  z-index:5;
}

.rock {
  position:absolute;
  width:4px;
  height:4px;
  border-radius:50%;
  background:#ffcc00;
  box-shadow:0 0 6px #ffcc00,0 0 12px #ffcc0055;
  opacity:0;
  transition:transform 0.15s linear,opacity 0.4s ease,width 0.3s ease,height 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
  z-index:7;
}

#info {
  width:90%;
  max-width:360px;
  margin-top:10px;
}

.box {
  border:1px solid #00ff0044;
  background:#001100aa;
  padding:6px;
  margin:4px 0;
  border-radius:6px;
  text-align:center;
}

select,button {
  margin:8px 0;
  padding:10px;
  border-radius:8px;
  border:none;
  background:#00ff00;
  color:#000;
  font-size:1em;
}

#scanRock {
  background:#ff4444;
  color:#fff;
  font-weight:bold;
}

#proximityMeter {
  width:90%;
  max-width:360px;
  height:18px;
  border-radius:10px;
  overflow:hidden;
  border:1px solid #00ff44;
  background:#003322;
}
#proximityFill {
  height:100%;
  width:0%;
  background:#ff4444;
  transition:width 0.3s ease;
}
</style>
</head>

<body>
<h1>Futuristic Prospecting Scanner</h1>

<select id="locationSelect">
  <option>Loading locations…</option>
</select>

<div id="deviceFrame">
  <div id="scanner-container">
    <div id="overlayPulse"></div>
    <div id="radarSweep"></div>
    <div id="radarArc"></div>
    <div id="arrow"></div>
  </div>
</div>

<div id="info">
  <div class="box" id="gps">GPS: —</div>
  <div class="box" id="target">Target: —</div>
  <div class="box" id="distance">Distance: —</div>
  <div class="box" id="compass">Compass: —</div>
  <div class="box" id="accuracy">Accuracy: —</div>
</div>

<div id="proximityMeter"><div id="proximityFill"></div></div>

<button id="scanRock">SCAN ROCK</button>

<script>
// ====== Locations with rarities ======
window.PROSPECTING_LOCATIONS = [
  { name:"Test Zone Alpha", lat:-26.6415, lng:152.9112, rarities:["common","common","rare","common","epic","common"] },
  { name:"Test Zone Bravo", lat:-26.6422, lng:152.9120, rarities:["common","rare","common","common","common","epic"] },
  { name:"Rocky Ridge", lat:-26.6430, lng:152.9135, rarities:["common","common","common","rare","common","epic"] },
  { name:"Hidden Creek", lat:-26.6400, lng:152.9100, rarities:["common","common","common","common","rare","common"] },
  { name:"Sunset Valley", lat:-26.6445, lng:152.9145, rarities:["common","rare","common","common","epic","common"] },
  { name:"Cooroy Mountain Base", lat:-26.6450, lng:152.9150, rarities:["rare","common","common","epic","common","common"] },
  { name:"Golden Boulder", lat:-26.6462, lng:152.9160, rarities:["common","epic","common","common","rare","common"] },
  { name:"Whispering Pines", lat:-26.6470, lng:152.9175, rarities:["common","common","rare","common","common","epic"] },
  { name:"Crystal Cavern", lat:-26.6485, lng:152.9180, rarities:["epic","common","common","rare","common","common"] },
  { name:"Emerald Plateau", lat:-26.6495, lng:152.9195, rarities:["common","rare","epic","common","common","common"] }
];

// ====== Core system ======
let LOCATIONS, targetIndex=0, currentLat=null, currentLon=null, heading=0, rocks=[];

const MAX_VIS=25, RADAR_R=160;
const scanner=document.getElementById("scanner-container");
const arrow=document.getElementById("arrow");
const sweep=document.getElementById("radarSweep");
const select=document.getElementById("locationSelect");
const fill=document.getElementById("proximityFill");

// Get rock color by rarity
function getRockColor(rarity){
  switch(rarity){
    case "common": return "#ffcc00";
    case "rare": return "#00ccff";
    case "epic": return "#ff00ff";
    default: return "#ffcc00";
  }
}

// Initialize
function init(){
  LOCATIONS = window.PROSPECTING_LOCATIONS || [];
  select.innerHTML = "";
  LOCATIONS.forEach((l,i)=>{
    const o = document.createElement("option");
    o.value=i;
    o.textContent=l.name;
    select.appendChild(o);
  });
  select.onchange = ()=>{ targetIndex=+select.value; spawnRocks(); };
  spawnRocks();
  startGPS();
  animate();
}

// Spawn rocks with rarity colors
function spawnRocks(){
  rocks.forEach(r=>r.el.remove());
  rocks=[];
  const t=LOCATIONS[targetIndex];
  for(let i=0;i<6;i++){
    const el=document.createElement("div");
    el.className="rock";
    scanner.appendChild(el);
    const rarity = t.rarities[i % t.rarities.length];
    const color = getRockColor(rarity);
    el.style.background=color;
    el.style.boxShadow=`0 0 6px ${color},0 0 12px ${color}55`;
    rocks.push({ el, lat: t.lat + (Math.random()-0.5)*0.00004, lng: t.lng + (Math.random()-0.5)*0.00004, rarity });
  }
}

// Haversine distance
function hav(a,b,c,d){
  const R=6371000;
  const dLat=(c-a)*Math.PI/180;
  const dLon=(d-b)*Math.PI/180;
  const x=Math.sin(dLat/2)**2 + Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(dLon/2)**2;
  return R*2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));
}

// Update rock positions
function updateRocks(){
  if(currentLat===null) return;
  rocks.forEach(r=>{
    const d=hav(currentLat,currentLon,r.lat,r.lng);
    if(d>MAX_VIS){ r.el.style.opacity=0; return; }
    const scale=(MAX_VIS-d)/MAX_VIS;
    const dx=(r.lng-currentLon)*90000;
    const dy=(r.lat-currentLat)*111000;
    const x=180 + dx/MAX_VIS*RADAR_R;
    const y=180 - dy/MAX_VIS*RADAR_R;
    r.el.style.transform=`translate(${x}px,${y}px)`;
    r.el.style.width = r.el.style.height = (4+scale*10)+"px";
    r.el.style.opacity = scale;
  });
}

// Animate radar sweep
function animate(){
  sweep.style.transform=`rotate(${Date.now()/25%360}deg)`;
  updateRocks();
  requestAnimationFrame(animate);
}

// GPS updates
function startGPS(){
  navigator.geolocation.watchPosition(p=>{
    currentLat=p.coords.latitude;
    currentLon=p.coords.longitude;
    document.getElementById("gps").textContent=`${currentLat.toFixed(6)}, ${currentLon.toFixed(6)}`;
    document.getElementById("accuracy").textContent=`Accuracy ±${p.coords.accuracy.toFixed(1)}m`;
    const t=LOCATIONS[targetIndex];
    const d=hav(currentLat,currentLon,t.lat,t.lng);
    document.getElementById("distance").textContent=`Distance: ${d.toFixed(1)}m`;
    document.getElementById("target").textContent=`Target: ${t.name}`;
    fill.style.width = Math.max(0,Math.min(100,(1-d/40)*100))+"%";
    if(d<6 && navigator.vibrate) navigator.vibrate([80,40,80]);
  },console.error,{enableHighAccuracy:true});
}

// Device compass
window.addEventListener("deviceorientation",e=>{
  if(e.alpha!=null){
    heading=360-e.alpha;
    arrow.style.transform=`translateX(-50%) rotate(${heading}deg)`;
    document.getElementById("compass").textContent=`Compass: ${heading.toFixed(0)}°`;
  }
});

init();
</script>
</body>
</html>
