<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Prospecting Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
body { margin:0; font-family:system-ui,sans-serif; background:#0b0b0b; color:#00ffcc; display:flex; flex-direction:column; align-items:center; justify-content:center; }
h1 { margin:10px 0; }
#scanner { width:240px; height:240px; border-radius:50%; border:3px solid #00ffcc; position:relative; margin:15px; }
#arrow { position:absolute; bottom:50%; left:50%; width:6px; height:100px; background:#ff4444; transform-origin:bottom center; transform:translateX(-50%) rotate(0deg); border-radius:4px; }
#info { width:90%; max-width:360px; font-size:0.95em; line-height:1.4; text-align:center; }
.box { border:1px solid #00ffcc44; padding:8px; margin:6px 0; border-radius:6px; }
button, select { margin:10px 0; padding:12px 22px; font-size:1em; border-radius:8px; border:none; background:#00ffcc; color:#000; }
select { width:90%; max-width:360px; }
</style>
</head>
<body>

<h1>Prospecting Scanner</h1>

<select id="locationSelect">
  <option>Loading locations...</option>
</select>

<div id="scanner">
  <div id="arrow"></div>
</div>

<div id="info">
  <div class="box" id="gps">GPS: â€”</div>
  <div class="box" id="target">Target: â€”</div>
  <div class="box" id="distance">Distance: â€”</div>
  <div class="box" id="bearing">Bearing: â€”</div>
  <div class="box" id="compass">Compass: â€”</div>
  <div class="box" id="accuracy">Accuracy: â€”</div>
  <div class="box" id="hotcold">Proximity: â€”</div>
</div>

<button id="start">Activate Scanner</button>
console.log("PROSPECTING_LOCATIONS:", typeof PROSPECTING_LOCATIONS, PROSPECTING_LOCATIONS);
  
<!-- ================= LOCATIONS.JS ================= -->
<script src="locations.js"></script>

<script>
/* ------------------ WAIT FOR LOCATIONS.JS ------------------ */
function initScanner() {
  if (!Array.isArray(PROSPECTING_LOCATIONS) || PROSPECTING_LOCATIONS.length === 0) {
    alert("No PROSPECTING_LOCATIONS found in locations.js!");
    return;
  }

  /* ------------------ VARIABLES ------------------ */
  let TARGET = PROSPECTING_LOCATIONS[0];
  let TARGET_LAT = TARGET.lat;
  let TARGET_LON = TARGET.lng;
  let TARGET_NAME = TARGET.name;

  let currentLat = null;
  let currentLon = null;
  let compassHeading = null;
  let smoothAngle = 0;

  const arrow = document.getElementById("arrow");
  const select = document.getElementById("locationSelect");

  /* ------------------ POPULATE DROPDOWN ------------------ */
  select.innerHTML = '';
  PROSPECTING_LOCATIONS.forEach((loc,i)=>{
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = loc.name;
    select.appendChild(opt);
  });
  select.value = 0;

  select.addEventListener('change',()=>{
    const idx = parseInt(select.value);
    TARGET = PROSPECTING_LOCATIONS[idx];
    TARGET_LAT = TARGET.lat;
    TARGET_LON = TARGET.lng;
    TARGET_NAME = TARGET.name;
    update();
  });

  /* ------------------ HAVERSINE ------------------ */
  function haversine(lat1, lon1, lat2, lon2) {
    const R = 6371000;
    const toRad = d => d*Math.PI/180;
    const dLat = toRad(lat2-lat1);
    const dLon = toRad(lon2-lon1);
    const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
    return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
  }

  /* ------------------ BEARING ------------------ */
  function bearing(lat1, lon1, lat2, lon2) {
    const toRad = d => d*Math.PI/180;
    const toDeg = r => (r*180/Math.PI+360)%360;
    const y = Math.sin(toRad(lon2-lon1))*Math.cos(toRad(lat2));
    const x = Math.cos(toRad(lat1))*Math.sin(toRad(lat2)) - Math.sin(toRad(lat1])*Math.cos(toRad(lat2))*Math.cos(toRad(lon2-lon1));
    return toDeg(Math.atan2(y,x));
  }

  /* ------------------ GPS ------------------ */
  function startGPS() {
    if(!navigator.geolocation){ alert("Geolocation not supported!"); return; }
    navigator.geolocation.watchPosition(
      pos => {
        currentLat = pos.coords.latitude;
        currentLon = pos.coords.longitude;
        document.getElementById("gps").textContent = `You: ${currentLat.toFixed(6)}, ${currentLon.toFixed(6)}`;
        document.getElementById("accuracy").textContent = `Accuracy: Â±${pos.coords.accuracy.toFixed(1)} m`;
        update();
      },
      err=>alert("GPS error: "+err.message),
      {enableHighAccuracy:true, maximumAge:0, timeout:10000}
    );
  }

  /* ------------------ COMPASS ------------------ */
  function onOrientation(e){
    let heading=null;
    if(typeof e.webkitCompassHeading==="number") heading=e.webkitCompassHeading;
    else if(e.alpha!==null) heading=360-e.alpha;
    if(heading===null) return;
    compassHeading=heading;
    update();
  }

  /* ------------------ UPDATE ------------------ */
  function update(){
    if(currentLat===null||currentLon===null||compassHeading===null) return;
    const dist=haversine(currentLat,currentLon,TARGET_LAT,TARGET_LON);
    const bear=bearing(currentLat,currentLon,TARGET_LAT,TARGET_LON);
    const relative=(bear-compassHeading+360)%360;
    smoothAngle+=(relative-smoothAngle)*0.15;
    arrow.style.transform=`translateX(-50%) rotate(${smoothAngle}deg)`;

    document.getElementById("target").textContent=`Target: ${TARGET_NAME} (${TARGET_LAT}, ${TARGET_LON})`;
    document.getElementById("distance").textContent=dist<1000?`Distance: ${dist.toFixed(1)} m`:`Distance: ${(dist/1000).toFixed(3)} km`;
    document.getElementById("bearing").textContent=`Bearing: ${bear.toFixed(1)}Â°`;
    document.getElementById("compass").textContent=`Compass: ${compassHeading.toFixed(1)}Â°`;

    // HOT / COLD indicator
    let hotcold='';
    if(dist<=20) hotcold='ðŸ”¥ Very Hot';
    else if(dist<=50) hotcold='ðŸŒ¡ï¸ Hot';
    else if(dist<=100) hotcold='ðŸŒ¡ï¸ Warm';
    else if(dist<=200) hotcold='â„ï¸ Cold';
    else hotcold='ðŸ¥¶ Very Cold';
    document.getElementById("hotcold").textContent=`Proximity: ${hotcold}`;
  }

  /* ------------------ START ------------------ */
  async function start(){
    if(typeof DeviceOrientationEvent!=="undefined" && typeof DeviceOrientationEvent.requestPermission==="function"){
      const res=await DeviceOrientationEvent.requestPermission();
      if(res!=="granted"){ alert("Compass permission denied"); return; }
    }
    window.addEventListener("deviceorientation",onOrientation,true);
    window.addEventListener("deviceorientationabsolute",onOrientation,true);
    startGPS();
  }

  document.getElementById("start").addEventListener("click",start);
}

/* Wait a tiny bit to ensure locations.js has loaded */
setTimeout(initScanner, 50);
</script>

</body>
</html>
