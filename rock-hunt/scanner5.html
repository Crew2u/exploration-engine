<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Futuristic Prospecting Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
body{
  margin:0;
  background:#000;
  color:#0f0;
  font-family:system-ui,sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:10px;
}
h1{margin:8px;text-shadow:0 0 10px #0f0}

/* Device */
#deviceFrame{
  width:400px;height:400px;
  border:10px solid #00ff44;
  border-radius:30px;
  box-shadow:0 0 50px #00ff44 inset;
  background:#001100;
  position:relative;
  display:flex;
  justify-content:center;
  align-items:center;
}

#scanner{
  width:360px;height:360px;
  border-radius:50%;
  position:relative;
  overflow:hidden;
  background:radial-gradient(circle,#001100 0%,#002200 80%);
  border:3px solid #00ff00;
}

/* Radar */
#radarSweep{
  position:absolute;inset:0;
  background:conic-gradient(rgba(0,255,0,.25),transparent 25deg);
  border-radius:50%;
  pointer-events:none;
  z-index:3;
}
#radarArc{
  position:absolute;inset:0;
  border-radius:50%;
  box-shadow:0 0 20px #00ff44 inset,0 0 30px #00ff4488 inset;
  pointer-events:none;
  z-index:2;
}
#radarRings{position:absolute;inset:0;pointer-events:none; z-index:1;}
.ring{
  position:absolute;
  border:1px solid #00ff22;
  border-radius:50%;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  animation:pulse 4s infinite;
  opacity:.25;
}
@keyframes pulse{
  0%{width:0;height:0}
  100%{width:300px;height:300px;opacity:0}
}

/* Arrow */
#arrow{
  position:absolute;
  left:50%;bottom:50%;
  width:6px;height:120px;
  background:#ff4444;
  transform-origin:bottom center;
  box-shadow:0 0 10px #ff4444;
  z-index:4;
}

/* Rocks */
.rock{
  position:absolute;
  width:12px;height:12px;
  border-radius:50%;
  background:#ff0;
  box-shadow:0 0 6px #ff0;
  z-index:5;
}

/* QR */
#qrVideo{
  display:none;
  position:absolute;
  inset:0;
  object-fit:cover;
  border-radius:50%;
  z-index:6;
}
#qrPanel{
  position:absolute;
  bottom:8px;left:50%;
  transform:translateX(-50%);
  width:320px;height:180px;
  background:#002200cc;
  border:2px solid #00ff55;
  border-radius:10px;
  display:none;
  z-index:10;
}
#qrPanel iframe{width:100%;height:100%;border:none}

/* HUD */
#info{width:90%;max-width:360px;text-align:center}
.box{
  border:1px solid #00ff0044;
  background:#00110099;
  padding:6px;
  margin:4px 0;
  border-radius:6px;
}

#proximityMeter{
  width:90%;max-width:360px;
  height:20px;
  border-radius:10px;
  background:#003311;
  border:1px solid #00ff44;
}
#proximityFill{
  height:100%;
  width:0%;
  background:#ff4444;
  transition:width .2s;
}

button,select{
  margin:8px;
  padding:12px 20px;
  border:none;border-radius:8px;
  background:#00ff55;
  font-weight:bold;
  cursor:pointer;
}
#toggleCamera{background:#ffaa00}
#scanQR{background:#ff4444;color:#fff}
#toggleScanner{background:#44ff44}
</style>
</head>
<body>
<h1>Prospecting Scanner</h1>

<select id="locationSelect"></select>

<div id="deviceFrame">
  <div id="scanner">
    <video id="qrVideo" playsinline></video>
    <div id="radarSweep"></div>
    <div id="radarArc"></div>
    <div id="radarRings"></div>
    <div id="arrow"></div>
    <div id="qrPanel"><iframe></iframe></div>
  </div>
</div>

<div id="info">
  <div class="box" id="gps">GPS: â€”</div>
  <div class="box" id="target">Target: â€”</div>
  <div class="box" id="distance">Distance: â€”</div>
  <div class="box" id="bearing">Bearing: â€”</div>
  <div class="box" id="compass">Compass: â€”</div>
  <div class="box" id="accuracy">Accuracy: â€”</div>
  <div class="box" id="hotcold">Proximity: â€”</div>
</div>

<div id="proximityMeter"><div id="proximityFill"></div></div>

<button id="toggleScanner">Activate Scanner</button>
<button id="scanQR">Scan Rock QR</button>
<button id="toggleCamera">Toggle Camera</button>

<script src="locations.js"></script>
<script src="https://unpkg.com/jsqr/dist/jsQR.js"></script>
<script>
let active=false;
let lat=null,lng=null,heading=0;
let targetIndex=0;
let rocks=[];
let sweepAngle=0;
let gpsWatch=null;
let camStream=null;
let cameraOn=false;

const arrow=document.getElementById("arrow");
const sweep=document.getElementById("radarSweep");
const scanner=document.getElementById("scanner");
const qrVideo=document.getElementById("qrVideo");
const qrPanel=document.getElementById("qrPanel");
const qrFrame=qrPanel.querySelector("iframe");
const proximityFill=document.getElementById("proximityFill");

const select=document.getElementById("locationSelect");
PROSPECTING_LOCATIONS.forEach((l,i)=>{
  const o=document.createElement("option");
  o.value=i;o.textContent=l.name;
  select.appendChild(o);
});

select.onchange=()=>{
  targetIndex=parseInt(select.value);
  spawnRocks();
  update();
};

function haversine(a,b,c,d){
  const R=6371000;
  const dLat=(c-a)*Math.PI/180;
  const dLon=(d-b)*Math.PI/180;
  const x=Math.sin(dLat/2)**2+
          Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*
          Math.sin(dLon/2)**2;
  return R*2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));
}

function calcBearing(a,b,c,d){
  return (Math.atan2(
    Math.sin((d-b)*Math.PI/180)*Math.cos(c*Math.PI/180),
    Math.cos(a*Math.PI/180)*Math.sin(c*Math.PI/180)-
    Math.sin(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.cos((d-b)*Math.PI/180)
  )*180/Math.PI+360)%360;
}

function spawnRocks(){
  rocks.forEach(r=>r.remove());
  rocks=[];
  for(let i=0;i<8;i++){
    const r=document.createElement("div");
    r.className="rock";
    r.dataset.angle=Math.random()*Math.PI*2;
    scanner.appendChild(r);
    rocks.push(r);
  }
}

function update(){
  if(!active||lat==null) return;
  const t=PROSPECTING_LOCATIONS[targetIndex];
  const d=haversine(lat,lng,t.lat,t.lng);
  const b=calcBearing(lat,lng,t.lat,t.lng);
  const rel=(b-heading+360)%360;

  arrow.style.transform=`translateX(-50%) rotate(${rel}deg)`;

  document.getElementById("target").textContent=`Target: ${t.name} (${t.lat.toFixed(6)}, ${t.lng.toFixed(6)})`;
  document.getElementById("distance").textContent=`Distance: ${d.toFixed(1)} m`;
  document.getElementById("bearing").textContent=`Bearing: ${b.toFixed(1)}Â°`;
  document.getElementById("compass").textContent=`Compass: ${heading.toFixed(1)}Â°`;

  let hotcold='';
  if(d<=5) hotcold='ðŸ”¥ Very Hot';
  else if(d<=20) hotcold='ðŸŒ¡ï¸ Hot';
  else if(d<=50) hotcold='ðŸŒ¡ï¸ Warm';
  else if(d<=100) hotcold='â„ï¸ Cold';
  else hotcold='ðŸ¥¶ Very Cold';
  document.getElementById("hotcold").textContent=`Proximity: ${hotcold}`;

  proximityFill.style.width=`${Math.min(1,200/d)*100}%`;

  rocks.forEach(r=>{
    const radius=Math.min(160,d);
    const x=180+Math.cos(r.dataset.angle-heading*Math.PI/180)*radius;
    const y=180+Math.sin(r.dataset.angle-heading*Math.PI/180)*radius;
    r.style.transform=`translate(${x}px,${y}px)`;
    if(d<5 && Math.random()<0.03 && navigator.vibrate) navigator.vibrate(80);
  });
}

function animateSweep(){
  if(!active) return;
  sweepAngle=(sweepAngle+2)%360;
  sweep.style.transform=`rotate(${sweepAngle}deg)`;
  requestAnimationFrame(animateSweep);
}

// GPS
if(navigator.geolocation){
  gpsWatch=navigator.geolocation.watchPosition(p=>{
    lat=p.coords.latitude;
    lng=p.coords.longitude;
    document.getElementById("gps").textContent=`GPS: ${lat.toFixed(6)}, ${lng.toFixed(6)}`;
    document.getElementById("accuracy").textContent=`Accuracy: Â±${p.coords.accuracy.toFixed(1)} m`;
    update();
  },err=>alert("GPS error: "+err.message),{enableHighAccuracy:true});
}

// Compass
window.addEventListener("deviceorientation",e=>{
  if(e.alpha!=null){ heading=360-e.alpha; update(); }
});

// Buttons
document.getElementById("toggleScanner").onclick=()=>{
  active=!active;
  if(active){
    spawnRocks();
    animateSweep();
  }
};

document.getElementById("toggleCamera").onclick=async()=>{
  if(cameraOn){
    camStream.getTracks().forEach(t=>t.stop());
    qrVideo.style.display="none";
    cameraOn=false;
  }else{
    camStream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
    qrVideo.srcObject=camStream;
    qrVideo.play();
    qrVideo.style.display="block";
    cameraOn=true;
  }
};

document.getElementById("scanQR").onclick=()=>{
  if(!cameraOn) return;
  const canvas=document.createElement("canvas");
  const ctx=canvas.getContext("2d");
  function scan(){
    if(!cameraOn) return;
    canvas.width=qrVideo.videoWidth;
    canvas.height=qrVideo.videoHeight;
    ctx.drawImage(qrVideo,0,0);
    const img=ctx.getImageData(0,0,canvas.width,canvas.height);
    const code=jsQR(img.data,canvas.width,canvas.height);
    if(code){
      qrFrame.src=code.data;
      qrPanel.style.display="block";
      return;
    }
    requestAnimationFrame(scan);
  }
  scan();
};
</script>
</body>
</html>
